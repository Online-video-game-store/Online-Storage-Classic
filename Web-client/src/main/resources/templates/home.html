<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Products</title>
    <link rel="stylesheet" th:href="@{/css/heder.css}">
    <link rel="stylesheet" th:href="@{/css/left-panel.css}">
    <link rel="stylesheet" th:href="@{/css/product.css}">
    <link rel="stylesheet" th:href="@{/css/pagination.css}">
    <link rel="stylesheet" th:href="@{/css/notification.css}">
    <link rel="stylesheet" th:href="@{/css/cart-popup.css}">
    <link rel="stylesheet" th:href="@{/css/product-model.css}">
    <script th:src="@{js/add-to-cart.js}"></script>
    <script th:src="@{js/cart-popup.js}"></script>
    <script th:src="@{js/web-socket.js}"></script>
    <script th:src="@{js/product-popup.js}"></script>
</head>

<body>

<div class="header">
    <div class="page-title">–ò–≥—Ä—ã –¥–ª—è –ü–ö8000</div>
    <div class="user-info">
        <div th:if="${isAuthenticated}">
            <span th:text="'–ü—Ä–∏–≤–µ—Ç, ' + ${username} + '!'">–ü—Ä–∏–≤–µ—Ç, –ì–æ—Å—Ç—å!</span>
        </div>
        <div th:if="${isAdmin}">
            <a th:href="@{/pk8000/catalog/index/setup}" class="login-button">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</a>
        </div>
        <div th:if="${isAdmin}">
            <a th:href="@{/pk8000/catalog/index/statistics}" class="login-button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
        </div>
        <div th:if="${isAuthenticated}">
            <a th:href="@{/logout}" class="logout-button">–í—ã—Ö–æ–¥</a>
        </div>
        <div th:if="${!isAuthenticated}">
            <a th:href="@{/oauth2/authorization/online-store-client-id}" class="login-button">–í—Ö–æ–¥</a>
        </div>

        <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
        <div class="cart">
            <a th:href="@{/cart}" class="cart-link">
                üõí –ö–æ—Ä–∑–∏–Ω–∞
                <span class="cart-count" th:text="${cartItemCount}">0</span>
            </a>
        </div>
    </div>
</div>

<div class="container">
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ -->
    <div class="sidebar">
        <div class="categories">
            <div th:each="category : ${categories}"
                 class="category-button"
                 th:classappend="${category.name == currentCategory} ? 'active-category' : ''"
                 th:data-category-id="${category.id}"
                 onclick="redirectToCategory(this)">
                <span th:text="${category.name}"></span>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="filter">
            <h3>–§–∏–ª—å—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤</h3>
            <input type="text" th:value="${productName}" id="productName" placeholder="–ò–º—è —Ç–æ–≤–∞—Ä–∞" class="filter-input">
            <input type="number" th:value="${minPrice}" id="minPrice" placeholder="–ú–∏–Ω. —Ü–µ–Ω–∞" min="0" class="filter-input">
            <input type="number" th:value="${maxPrice}" id="maxPrice" placeholder="–ú–∞–∫—Å. —Ü–µ–Ω–∞" min="0" class="filter-input">
            <button onclick="redirectToCategory()" class="filter-button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
    </div>
    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–æ–≤–∞—Ä–æ–≤ -->
    <main class="content">
        <div class="product-grid">
            <div th:each="product : ${products}" class="product-item" th:data-name="${product.name}" th:data-price="${product.price}">
                <div class="product-title" th:text="${product.name}">Product Name</div>
                <div class="product-image-container">
                    <div class="image-wrapper">
                        <img th:each="imgUrl, iterStat : ${product.imageUrls}"
                             th:src="@{${imgUrl}}"
                             class="product-image"
                             th:classappend="${iterStat.index != 0} ? ' hidden' : ''"
                             alt="Product image" />
<!--                        <div class="zoom-icon">&#128269;</div> &lt;!&ndash; Unicode –∏–∫–æ–Ω–∫–∞ –ª—É–ø—ã &ndash;&gt;-->
                    </div>
                </div>
                <div class="product-description" th:text="${product.description}">Product description...</div>
                <div class="product-price" th:text="'$' + ${product.price}">Price</div>
                <form>
                    <input type="hidden" name="productId" th:value="${product.id}" />
                    <div class="quantity-controls">
                        <button type="button" onclick="decreaseQuantity(this)">-</button>
                        <input type="number" name="quantity" value="1" min="1" class="quantity-input" style="width: 50px; text-align: center;" />
                        <button type="button" onclick="increaseQuantity(this)">+</button>
                    </div>
                    <button type="button" class="buy-button">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                </form>
            </div>
        </div>
    </main>
</div>


<div class="pagination-container">
    <!-- –ü–∞–≥–∏–Ω–∞—Ç–æ—Ä. –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫. —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ñ–∏–ª—å—Ç—Ä–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º -->
    <div class="pagination" th:with="startPage=${currentPage > 5 ? currentPage - 5 : 0},
                                     endPage=${totalPages > currentPage + 5 ? currentPage + 5 : totalPages - 1}">
        <ul>
            <!-- –ö–Ω–æ–ø–∫–∞ "Previous" -->
            <li th:if="${currentPage > 0}">
                <form th:action="@{/pk8000/catalog/index}" method="get" style="display: inline;">
                    <input type="hidden" name="elemsOfPage" th:value="${elemsOfPage}">
                    <input type="hidden" name="pageNo" th:value="${currentPage - 1}">
                    <input type="hidden" name="categoryId" th:value="${categoryId}">
                    <button type="submit" class="pagination-button">Previous</button>
                </form>
            </li>

            <!-- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü -->
            <li th:each="i : ${#numbers.sequence(startPage, endPage)}">
                <form th:action="@{/pk8000/catalog/index}" method="get" style="display: inline;">
                    <input type="hidden" name="elemsOfPage" th:value="${elemsOfPage}">
                    <input type="hidden" name="pageNo" th:value="${i}">
                    <input type="hidden" name="categoryId" th:value="${categoryId}">
                    <button type="submit"
                            class="pagination-button"
                            th:classappend="${currentPage == i} ? 'active' : ''"
                            th:text="${i + 1}">
                    </button>
                </form>
            </li>

            <!-- –ö–Ω–æ–ø–∫–∞ "Next" -->
            <li th:if="${currentPage < totalPages - 1}">
                <form th:action="@{/pk8000/catalog/index}" method="get" style="display: inline;">
                    <input type="hidden" name="elemsOfPage" th:value="${elemsOfPage}">
                    <input type="hidden" name="pageNo" th:value="${currentPage + 1}">
                    <input type="hidden" name="categoryId" th:value="${categoryId}">
                    <button type="submit" class="pagination-button">Next</button>
                </form>
            </li>
        </ul>
    </div>
</div>


<!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
<div id="cart-popup" class="cart-popup">
    <div class="cart-popup-content">
        <span class="close-button">&times;</span>
        <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>

        <div class="cart-items">
            <!-- –¢–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JS -->
        </div>

        <div class="cart-total">
            <strong>–ò—Ç–æ–≥–æ:</strong> <span>$0.00</span>
        </div>
        <button class="checkout-button">–û–ø–ª–∞—Ç–∏—Ç—å</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ —Ç–æ–≤–∞—Ä–∞ -->
<div id="product-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>

        <div class="modal-image-wrapper">
            <div class="modal-image-container">
                <img id="modal-image" class="modal-image" src="" alt="Product">
            </div>
            <button id="prev-image" class="nav-button">&#10094;</button>
            <button id="next-image" class="nav-button">&#10095;</button>
        </div>
        <div class="modal-info">
            <h2 id="modal-title">–ù–∞–∑–≤–∞–Ω–∏–µ</h2>
            <p class="price" id="modal-price">–¶–µ–Ω–∞</p>
            <p class="category" id="modal-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</p>
            <p id="modal-description">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</p>
<!--            <button class="add-to-cart">–í –∫–æ—Ä–∑–∏–Ω—É</button>-->
        </div>
    </div>
</div>


<script>
    function redirectToCategory(element = null) {
        const selectedCategory = element ? element : document.querySelector('.category-button.active-category');
        const categoryId = selectedCategory ? selectedCategory.getAttribute("data-category-id") : '';

        const productName = document.getElementById("productName").value;
        const minPrice = document.getElementById("minPrice").value;
        const maxPrice = document.getElementById("maxPrice").value;
        const elemsOfPage = 8;
        const pageNo = 0;

        const queryParams = new URLSearchParams({
            categoryId,
            elemsOfPage,
            pageNo,
            productName,
            minPrice,
            maxPrice
        });
        window.location.href = `/pk8000/catalog/index?${queryParams.toString()}`;
    }

    function increaseQuantity(button) {
        const quantityInput = button.parentElement.querySelector('.quantity-input');
        let currentQuantity = parseInt(quantityInput.value);
        quantityInput.value = currentQuantity + 1;
    }

    function decreaseQuantity(button) {
        const quantityInput = button.parentElement.querySelector('.quantity-input');
        let currentQuantity = parseInt(quantityInput.value);
        if (currentQuantity > 1) {                          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            quantityInput.value = currentQuantity - 1;      // –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        }
    }
</script>


</body>
</html>