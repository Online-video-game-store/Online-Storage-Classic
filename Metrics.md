## Метрики.

### Общее.

Все метрики, кроме `health` и `info` доступны только с ролью `ADMIN`,
поэтому вызываем их примерно так:
```shell
curl -H "Authorization: Bearer $токен$" http://localhost:9010/CATALOG-SERVICE/actuator/metrics
```
То есть через `Gateway` и с действующим Jwt-токеном админа (о нем ниже).

В ответ получим json-список эндпоинтов доступных метрик.


### Создаем контейнер Prometheus.

Для удобного мониторинга подключим `Прометей`, через который можно задействовать удобные средства просмотра.

В папке `tools/prometheus/prometheus-docker`:

```shell
docker-compose build
docker-compose up -d
```
При запуске контейнера `entrypoint.sh` автоматически получает Jwt-токен от OAuth2-сервера, 
который и будет использовать `Prometheus`. Токен годен 60 минут, после чего контейнер
придется перезапустить.

Или поменять скрипт, сделав получение Jwt-токена через какие-то интервалы времени, например
с помощью `crone`.


### Просмотр метрик.

По адресу http://localhost:9090 будет доступен интерфейс Прометея. Альтернативно его доступность
можно проверить так:
```shell
curl -H "токен" http://localhost:9010/CATALOG-SERVICE/actuator/prometheus/
```
Токен можно получить через скрипт `get_token_client_credentials.http` или `get_token_client_credentials.bat`.

Скрипт `update-token.ps1` также получает токен, но сохраняет его в файл.

Но для удобного просмотра лучше подключить `Grafana`.
